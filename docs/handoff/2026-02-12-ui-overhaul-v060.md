# MojoVoice UI Overhaul v0.6.0 - Handoff Document

**Branch:** `ui-overhaul-v0.6.0`
**Base Branch:** `main`
**Date:** 2026-02-12
**Status:** UI overhaul complete (24/24 Ralph Loop tasks), browser dev mode established, ready for functionality implementation

---

## What Happened

A Ralph Loop (autonomous `claude -p` session) executed 24 tasks to completely redesign the UI. The old tab-based navigation was **removed** and replaced with a single-page "Mission Control" layout.

**Critical finding:** The Ralph Loop only verified that code compiles (`tsc` + `vite build`), not that the app actually renders in a browser. Several runtime crashes were found and fixed in a follow-up session:

- Tauri API calls crashed in browser mode (no `window.__TAURI__`)
- Mock data structures didn't match TypeScript interfaces
- Components didn't handle null/undefined states from async loads

**Fix applied:** `ui/src/lib/ipc.ts` now detects browser vs Tauri and returns properly-shaped mock data for all 21 Tauri commands.

---

## Current State

### What Works (verified with Playwright MCP)

| Component | Browser Mode | Tauri Mode |
|-----------|:----------:|:----------:|
| Main page load | ✅ | Untested |
| TEST MIC button + loading state | ✅ | Untested |
| Settings drawer (all sections) | ✅ | Untested |
| Advanced settings expand/collapse | ✅ | Untested |
| Close drawer (Escape key) | ✅ | Untested |
| System status collapse/expand | ✅ | Untested |
| History modal | ⚠️ Keyboard shortcut not working | Untested |
| TypeScript build | ✅ | ✅ |
| Production build | ✅ | ✅ |

### What Needs Work

1. **Tauri mode is completely untested** - The actual backend integration has not been verified
2. **History modal keyboard shortcut (Cmd+H)** - Not triggering in browser
3. **Minor: missing `key` prop** - Console warning in Settings drawer list rendering
4. **Legacy components still in codebase** - Dashboard.tsx, Settings.tsx, Navigation.tsx unused but present

---

## Architecture

### Component Hierarchy

```
App.tsx
└── Suspense (lazy loading)
    └── MissionControl.tsx (1412 lines - the entire UI)
        ├── Header ("MOJOVOICE" + Settings gear)
        ├── Giant TEST MIC Button (280×120px)
        ├── StatusBar (daemon status, model dropdown, language, mic)
        ├── Recent Transcriptions (last 5 + "View All")
        ├── SystemStatus (collapsible: GPU, memory, daemon, uptime)
        ├── Drawer (settings, slides from right)
        │   ├── Voice Recognition (model, language)
        │   ├── Recording (duration slider, audio device)
        │   ├── Behavior (trailing space toggle)
        │   └── Advanced (model path, vocab, status bar cmd, save audio)
        └── Modal (full history: search, filters, export, bulk delete)
```

### Key Files

| File | Purpose |
|------|---------|
| `ui/src/lib/ipc.ts` | Tauri IPC wrapper + browser mock data |
| `ui/src/stores/appStore.ts` | Zustand state (daemon, history, UI) |
| `ui/src/components/MissionControl.tsx` | Entire UI in one component |
| `ui/src/components/ui/StatusBar.tsx` | Daemon status + model switching |
| `ui/src/components/ui/SystemStatus.tsx` | System diagnostics panel |
| `ui/src/components/ui/Drawer.tsx` | Reusable slide-in drawer |
| `ui/src/components/ui/Modal.tsx` | Reusable fullscreen modal |
| `ui/src/components/ui/Button.tsx` | Neubrutalist button variants |
| `ui/src/styles/globals.css` | Design tokens + CSS variables |
| `docs/context/mojovoice-style-guide.md` | Complete design system spec |

---

## Mock Data System (Browser Dev Mode)

**File:** `ui/src/lib/ipc.ts`

```typescript
const isTauri = typeof window !== 'undefined' && '__TAURI__' in window;

// In browser mode, returns mock data instead of calling Tauri
if (isTauri) {
  result = await tauriInvoke<T>(command, args);
} else {
  result = getMockData(command) as T;
}
```

### Commands with mocks

All 21 Tauri commands have mock responses:
- `get_daemon_status`, `get_config`, `get_system_info`
- `get_transcription_history`, `list_audio_devices`
- `list_downloaded_models`, `list_available_models`, `get_storage_info`
- `validate_path`, `save_config`, `switch_model`
- `start/stop_recording`, `delete/clear_history`
- `delete_model`, `download_model`, `cancel_download`
- `start/stop/restart_daemon`

### Adding new commands

If a new Tauri command is added, add a mock case in `getMockData()` or the UI will crash in browser mode. The default fallback returns `{}` with a console warning.

---

## Tauri Backend Commands

Defined in `ui/src-tauri/src/main.rs` and `commands.rs`:

- **Daemon:** `get_daemon_status`, `start_daemon`, `stop_daemon`, `restart_daemon`
- **Recording:** `start_recording`, `stop_recording`, `cancel_recording`
- **History:** `get_transcription_history`, `delete_history_entry`, `clear_history`
- **Models:** `list_available_models`, `list_downloaded_models`, `download_model`, `delete_model`, `switch_model`, `cancel_download`, `get_storage_info`
- **System:** `get_system_info`, `get_config`, `save_config`, `validate_path`, `list_audio_devices`

---

## Design System ("Electric Night")

**Spec:** `docs/context/mojovoice-style-guide.md` (891 lines)

### Quick Reference

```css
--bg-void: #0A0E1A;         /* Darkest bg */
--bg-surface: #151B2E;      /* Card bg */
--accent-primary: #3B82F6;  /* Electric blue */
--success: #22C55E;         /* Acid green */
--error: #EF4444;           /* Hot red */
--text-primary: #F8FAFC;    /* Near white */
--border-brutal: #000000;   /* Neubrutalist borders */
--shadow-brutal: 4px 4px 0px 0px rgba(0,0,0,1);
```

- **Fonts:** JetBrains Mono (technical), Inter (UI)
- **Style:** Neubrutalism (thick borders, sharp corners, brutal shadows)
- **Animations:** 150-250ms, GPU-accelerated, honor `prefers-reduced-motion`
- **Accessibility:** WCAG 2.2 Level AA

---

## Development Commands

```bash
# UI in browser (mock data, no backend needed)
cd ui && npm run dev

# UI in Tauri (needs Rust backend + daemon)
cd ui && npm run tauri:dev

# Type check
cd ui && npx tsc --noEmit

# Production build
cd ui && npm run build

# Rust backend (CUDA)
RUSTFLAGS="-L /usr/lib64 -L /usr/local/lib/ollama" cargo build --release --features cuda
```

---

## Playwright MCP Testing

Screenshots must go in `docs/tmp/` (gitignored). Example:

```
docs/tmp/settings-debug.png
docs/tmp/main-page-validation.png
```

The `.playwright-mcp/` directory is gitignored. Console logs are ephemeral.

---

## What To Do Next

### Priority 1: Verify Tauri Mode
Run `npm run tauri:dev` and test all features with the real backend. The UI was only tested in browser mode with mocks.

### Priority 2: Fix Minor Issues
- History modal keyboard shortcut (Cmd+H)
- Missing `key` prop in Settings drawer list
- Model dropdown showing "No model loaded" instead of mock model name

### Priority 3: Remove Legacy Code
- `ui/src/components/Dashboard.tsx` (unused)
- `ui/src/components/Settings.tsx` (replaced by drawer)
- `ui/src/components/Navigation.tsx` (removed tab nav)

### Priority 4: Polish & Ship
- Runtime test all interactions with real daemon
- Update CHANGELOG.md for v0.6.0
- Merge to main
- Tag release

---

## Key Decisions Made

1. **Single-page over tabs** - Better UX flow for a focused tool
2. **Electric Night over emerald** - Stronger developer brand
3. **Neubrutalism over rounded** - Distinctive aesthetic
4. **Browser dev mode** - Enables Playwright MCP testing without backend
5. **Code splitting** - Lazy load Drawer/Modal for performance

## Open Questions

1. Should MissionControl.tsx (1412 lines) be split into smaller components?
2. When to implement the restart banner UI (deferred TODO)?
3. Priority of model manager integration vs global hotkey feature?
